; *****************************************************************************
; *                BOOGER SLIDE, A slide show by Delirium Gang.               *
; *                                 (ENDPART.PRG)                            *
; *                                                                           *
; * Code            => Power                                                  *
; * Zik             => Greg                                                   *
; * Gfxs            => Greg                                                   *
; *                                                                           *
; *****************************************************************************
    org #3000
    run EntryPoint
    nolist

; *****************************************************************************
;
; *****************************************************************************
EntryPoint

;
    ld a,#01
    ld (l34f4),a

;
    ld hl,#c000
    ld (l34f0),hl

;
    ld de,#c001
    ld (l34f2),de

;
    ld a,#02
    ld (l34ef),a

;
    ld hl,#5000
    ld (l34ed),hl

;
    ld hl,#c000
    ld (l34eb),hl

; Initialize songs
    mRAM_SELECT GA_RAM_BANK0,GA_RAM_CONFIG7
    call #4000
    call #5654

    mRAM_SELECT GA_RAM_BANK0,GA_RAM_CONFIG4
    call #4000
    call #5be2

; Modify horizontal screen width.
    ld bc,#bc01
    out (c),c
    ld bc,#bd30
    out (c),c
    ld bc,#bc02
    out (c),c
    ld bc,#bd32
    out (c),c
    ld bc,#bc03
    out (c),c
    ld bc,#bd08
    out (c),c

    ld hl,l3381
    ld (l3362),hl

; Set interrupt subroutine as RET-EI, set SP at &4000.
    di
    ld hl,(#0038)
    ld hl,#c9fb
    ld (#0038),hl
    ld sp,#0100
    ei

; Clear screen
    mMEMCLR &8000,&8000

; Copy Upper-left part 
    mRAM_SELECT GA_RAM_BANK0,GA_RAM_CONFIG5
    mCOPYSPRITE &4000,&d920,&78,&2e

; Copy Upper-right part 
    mCOPYSPRITE &6000,&d94e,&78,&2e

    mMEMCPY &c000,&8000,&4000

    mMEMCLR &c000,&4000

; Copy Lower-left part 
    mRAM_SELECT GA_RAM_BANK0,GA_RAM_CONFIG6
    mCOPYSPRITE &4000,&c180,&78,&2e

; Copy Lower-right part
    mCOPYSPRITE &6000,&c1ae,&78,&2e

; Switch to C0 bank.
    mRAM_SELECT GA_RAM_BANK0,GA_RAM_CONFIG0
    
; Set start address of video memory for first screen (&8000).
    ld bc,#bc0c
    out (c),c
    ld bc,#bd20
    out (c),c
    ld bc,#bc0d
    out (c),c
    ld bc,#bd00
    out (c),c

.EndPart_Loop

;
    ld b,#f5
.NoSync
    in a,(c)
    rra
    jp nc,NoSync

; Ink 0,0
    ld bc,#7f00
    out (c),c
    ld a,#54
    out (c),a

; Set VBL position to overflow value.
    ld bc,#bc07
    out (c),c
    ld bc,#bdff
    out (c),c

; Set low screen resolution (160x200x4bpp). 
    ld bc,#7f8c
    out (c),c

; Set first screen vertical size.
    ld bc,#bc04
    out (c),c
    ld bc,#bd13
    out (c),c

; Set screen palette
    ld hl,(l3362)
    ld d,#07
    ld c,#03
.l3142
    ld b,#7f
    out (c),c
    outi
    inc c
    dec d
    jp nz,l3142

;
    ld hl,(l3362)
    ld a,(hl)
    ld (l325e + 1),a

;
    halt

;
    ld a,(l34ef)
    dec a
    jp nz,l319b

;
.l315c
    ld b,#10
    ld hl,(l34f0)
    ld de,(l34f2)
    xor a
    ld (hl),a
    push bc
    push de
    push hl
    ld bc,#005f
    ldir
    pop hl
    call l3415
    ld (l34f0),hl
    pop de
    ex de,hl
    call l3415
    ex de,hl
    ld (l34f2),de
    pop bc
    djnz l3197

;
    ld a,#02
    ld (l34ef),a
    
;
    ld hl,#c000
    ld (l34f0),hl
    
;
    ld de,#c001
    ld (l34f2),de
    
;
    ld b,#10
.l3197
    ld a,b
    ld (l315c + 1),a
.l319b
;
    halt

;
    ld a,(l34ef)
    dec a
    jp z,l31b4

;
.l31a3
    ld a,#05
    dec a
    ld (l31a3 + 1),a
    jp nz,l31b4

;
    call l346e

;
    ld a,#05
    ld (l31a3 + 1),a

.l31b4
;
    ld a,#41
    call l341f
    cp #df
    call z,l3630
    cp #bf
    call z,l3636
    ld a,#40
    call l341f
    cp #df
    call z,l363c
    ld a,#42
    call l341f
    cp #ef
    call z,l3642

;
    halt

;
    ld bc,#7f8d
    out (c),c

;
    di
    ld bc,#7f01
    ld a,#4b
    out (c),c
    out (c),a
    inc c
    ld a,#4f
    out (c),c
    out (c),a
    ld a,#45
    inc c
    out (c),c
    out (c),a
    ei

;
    ld bc,#bc04
    out (c),c
    ld bc,#bd13
    out (c),c
    ld bc,#bc0c
    out (c),c
    ld bc,#bd30
    out (c),c
    ld bc,#bc0d
    out (c),c
    ld bc,#bd00
    out (c),c
    ld b,#10

;
.l3216
    ds 59,0
    djnz l3216

;
    ld bc,#7f8c
    out (c),c

;
    di
    ld bc,#7f03
    out (c),c
.l325e
    ld a,#00
    out (c),a
    ei

;
    ld a,(l34f4)
    cp #01
    jp z,l34f6

;
    halt

.l326c
;
    ld bc,#7fc0
    out (c),c

;
    ld a,#0a
    call l3448
    cp #0f
    jp nz,l3297

;
.l327c equ $ + 1
    jp l328c

; *****************************************************************************
; 
; ***************************************************************************** 
.l327e
;
    ld a,#23
    ld (l331e),a

;
    ld hl,l328c
    ld (l327c),hl
    jp l3297
    
; *****************************************************************************
; 
; ***************************************************************************** 
.l328c
;
    ld a,#2b
    ld (l331e),a

;
    ld hl,l327e
    ld (l327c),hl

;
.l3297
    ld a,#0a
    call l3448
    cp #0e
    jp nz,l3319
    
.l32a1
    jp l330d

; *****************************************************************************
; 
; ***************************************************************************** 
.l32a4
;
    ld hl,l336c
    ld (l340d),hl

;
    ld hl,l32b3
    ld (l32a1 + 1),hl
    jp l3319
    
; *****************************************************************************
; 
; ***************************************************************************** 
.l32b3
;
    ld hl,l33ab
    ld (l340d),hl

;
    ld hl,l32c2
    ld (l32a1 + 1),hl
    jp l3319
    
; *****************************************************************************
; 
; ***************************************************************************** 
.l32c2
;
    ld hl,l3396
    ld (l340d),hl

;
    ld hl,l32d1
    ld (l32a1 + 1),hl
    jp l3319

; *****************************************************************************
; 
; ***************************************************************************** 
.l32d1
;
    ld hl,l33d5
    ld (l340d),hl

;
    ld hl,l32e0
    ld (l32a1 + 1),hl
    jp l3319

; *****************************************************************************
; 
; ***************************************************************************** 
.l32e0
;
    ld hl,l33c0
    ld (l340d),hl

;
    ld hl,l32ef
    ld (l32a1 + 1),hl
    jp l3319

; *****************************************************************************
; 
; ***************************************************************************** 
.l32ef
;
    ld hl,l33ff
    ld (l340d),hl

;
    ld hl,l32fe
    ld (l32a1 + 1),hl
    jp l3319

; *****************************************************************************
; 
; ***************************************************************************** 
.l32fe
;
    ld hl,l33ea
    ld (l340d),hl

;
    ld hl,l330d
    ld (l32a1 + 1),hl
    jp l3319

; *****************************************************************************
; 
; ***************************************************************************** 
.l330d
;
    ld hl,l3381
    ld (l340d),hl

;
    ld hl,l32a4
    ld (l32a1 + 1),hl

;
.l3319
    ld a,#07
    ld hl,(l3362)
.l331e
    inc hl
    ld (l3362),hl
    dec a
    call z,l340c

;
    ld (l3319 + 1),a
    ld a,(l34f4)
    cp #02
    call z,l351d

;
    ld a,(l34f4)
    cp #03
    call z,l3542

;
    ld a,(l34f4)
    cp #04
    call z,l3567

;
    ld bc,#bc0c
    out (c),c
    ld bc,#bd20
    out (c),c
    ld bc,#bc0d
    out (c),c
    ld bc,#bd00
    out (c),c
    ld bc,#bc07
    out (c),c
    ld bc,#bd00
    out (c),c

    jp EndPart_Loop

; *****************************************************************************
; 
; ***************************************************************************** 
.l3362
    dw 0
   
; *****************************************************************************
; 
; ***************************************************************************** 
    db #54,#58,#5d,#5f,#4f,#43,#4b,#54

; *****************************************************************************
; 
; ***************************************************************************** 
.l336c
    db #58,#5d,#5f,#4f,#43,#4b,#54,#58
    db #5d,#5f,#4f,#43,#4b,#45,#4d,#4a
    db #4b,#4a,#4d,#45,

; *****************************************************************************
; 
; ***************************************************************************** 
l3381
    db #45,#4d,#4a,#4b,#4a,#4d,#45,#45
    db #4d,#4a,#4b,#4a,#4d,#45,#54,#5c
    db #56,#40,#59,#43

; *****************************************************************************
; 
; ***************************************************************************** 
l3396
    db #4b,#54,#5c,#56,#40,#59,#43,#4b
    db #54,#5c,#56,#40,#59,#43,#4b,#5c
    db #4c,#4e,#4a,#4e
    

; *****************************************************************************
; 
; ***************************************************************************** 
.l33ab
    db #4c,#5c,#5c,#4c,#4e,#4a,#4e,#4c
    db #5c,#5c,#4c,#4e,#4a,#4e,#4c,#5c
    db #54,#5c,#4c,#45

; *****************************************************************************
; 
; ***************************************************************************** 
.l33c0
    db #4f,#43,#4b,#54,#5c,#4c,#45,#4f
    db #43,#4b,#54,#5c,#4c,#45,#4f,#43
    db #4b,#5d,#5f,#52

; *****************************************************************************
; 
; ***************************************************************************** 
.l33d5
    db #53,#52,#5f,#5d,#5d,#5f,#52,#53
    db #52,#5f,#5d,#5d,#5f,#52,#53,#52
    db #5f,#53,#54,#44

; *****************************************************************************
; 
; ***************************************************************************** 
.l33ea
    db #5d,#5f,#4f,#59,#4b,#54,#44,#5d
    db #5f,#4f,#59,#4b,#54,#44,#5d,#5f
    db #4f,#59,#4b,#40

; *****************************************************************************
; 
; ***************************************************************************** 
.l33ff
    db #46,#52,#4b,#52,#46,#40,#40,#46
    db #52,#4b,#52,#46,#40,#40,#46,#52
    db #4b,#52,#46,#40
    
    